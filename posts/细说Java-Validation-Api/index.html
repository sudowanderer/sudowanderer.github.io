<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="细说Java Validation Api" /><meta property="og:locale" content="en" /><meta name="description" content="概述" /><meta property="og:description" content="概述" /><link rel="canonical" href="https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/" /><meta property="og:url" content="https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/" /><meta property="og:site_name" content="Mike Liu" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-06T05:30:57+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="细说Java Validation Api" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="xVkNsBgz6aC0Ez9SNuHLQF-akYx2t4WN0CXkgsmo-3A" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-12-06T05:30:57+08:00","datePublished":"2020-12-06T05:30:57+08:00","description":"概述","headline":"细说Java Validation Api","mainEntityOfPage":{"@type":"WebPage","@id":"https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/"},"url":"https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/"}</script><title>细说Java Validation Api | Mike Liu</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mike Liu"><meta name="application-name" content="Mike Liu"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://lh3.googleusercontent.com/a-/AOh14GhrBKBF8ViVZd_A3xDI-Qy_k9AoDtyPyMd6OoPe=s288-p-rw-no " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mike Liu</a></div><div class="site-subtitle font-italic">Stay Hungry Stay Foolish</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/xiaod-dev" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['geniusmikeliu','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>细说Java Validation Api</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>细说Java Validation Api</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/xiaod-dev">Mike Liu</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1607203857" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2020-12-06 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2101 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><h2 id="概述"><span class="mr-2">概述</span><a href="#概述" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>日常开发中经常需要对接口的入参进行参数校验，使用Java Validation API来进行校验参数，我们只需要在bean的字段上加上所需要的注解即可完成校验。</p><p>这里Java Validation API指的是</p><p>规范中的<strong>Bean Validation 2.0</strong>。该规范中定义了许多约束性注解，如@NotBlank,@Size,@Max,@Email等，以方便对bean的字段进行对应的校验</p><h2 id="依赖"><span class="mr-2">依赖</span><a href="#依赖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>注意，JSR 380只是定义了规范，体现在代码中就是一些注解，其并没有对应的实现。如果不使用Spring等相关框架的话，我们需要选择适合自己的第三方实现。</p><h3 id="javaxvalidation-maven坐标"><span class="mr-2">javax.validation maven坐标</span><a href="#javaxvalidation-maven坐标" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">&lt;!--</span> <span class="nl">https:</span><span class="c1">//mvnrepository.com/artifact/javax.validation/validation-api --&gt;</span>
<span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">javax</span><span class="o">.</span><span class="na">validation</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">validation</span><span class="o">-</span><span class="n">api</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">2.0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="na">Final</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</pre></table></code></div></div><p>这是javax.validation的官方maven坐标。如果我们使用Spring，我们并不需要额外导入上面的依赖，Spring已经内置好了。</p><h3 id="使用springboot-validation-starter"><span class="mr-2">使用Springboot validation starter</span><a href="#使用springboot-validation-starter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>在Springboot项目中，使用spring-boot-starter-validation的依赖即可完成依赖的引入。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="o">&lt;</span><span class="n">project</span> <span class="n">xmlns</span><span class="o">=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="nl">xmlns:</span><span class="n">xsi</span><span class="o">=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="nl">xsi:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">modelVersion</span><span class="o">&gt;</span><span class="mf">4.0</span><span class="o">.</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">modelVersion</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parent</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">parent</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="na">RELEASE</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">relativePath</span><span class="o">/&gt;</span> <span class="o">&lt;!--</span> <span class="n">lookup</span> <span class="n">parent</span> <span class="n">from</span> <span class="n">repository</span> <span class="o">--&gt;</span>
    <span class="o">&lt;/</span><span class="n">parent</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">example</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">java</span><span class="o">-</span><span class="n">validation</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="o">-</span><span class="no">SNAPSHOT</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">dependencies</span><span class="o">&gt;</span>
         <span class="o">&lt;!--</span> <span class="n">添加下面这个依赖</span><span class="o">--&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">validation</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">dependencies</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">project</span><span class="o">&gt;</span>
</pre></table></code></div></div><p>Spring boot项目直接使用parent标签继承Spring官方的pom，并加上spring-boot-starter-validation依赖即可。</p><p>Idea中可以按ctrl查看spring-boot-starter-validation的官方pom配置，可发现Spring官方其实使用的是<strong>hibernate-validator</strong>实现。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">"1.0"</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">project</span> <span class="nl">xsi:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span> <span class="n">xmlns</span><span class="o">=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
    <span class="nl">xmlns:</span><span class="n">xsi</span><span class="o">=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="o">&gt;</span>
  <span class="o">&lt;!--</span> <span class="nc">This</span> <span class="n">module</span> <span class="n">was</span> <span class="n">also</span> <span class="n">published</span> <span class="n">with</span> <span class="n">a</span> <span class="n">richer</span> <span class="n">model</span><span class="o">,</span> <span class="nc">Gradle</span> <span class="n">metadata</span><span class="o">,</span>  <span class="o">--&gt;</span>
  <span class="o">&lt;!--</span> <span class="n">which</span> <span class="n">should</span> <span class="n">be</span> <span class="n">used</span> <span class="n">instead</span><span class="o">.</span> <span class="nc">Do</span> <span class="n">not</span> <span class="n">delete</span> <span class="n">the</span> <span class="n">following</span> <span class="n">line</span> <span class="n">which</span>  <span class="o">--&gt;</span>
  <span class="o">&lt;!--</span> <span class="n">is</span> <span class="n">to</span> <span class="n">indicate</span> <span class="n">to</span> <span class="nc">Gradle</span> <span class="n">or</span> <span class="n">any</span> <span class="nc">Gradle</span> <span class="n">module</span> <span class="n">metadata</span> <span class="n">file</span> <span class="n">consumer</span>  <span class="o">--&gt;</span>
  <span class="o">&lt;!--</span> <span class="n">that</span> <span class="n">they</span> <span class="n">should</span> <span class="n">prefer</span> <span class="n">consuming</span> <span class="n">it</span> <span class="n">instead</span><span class="o">.</span> <span class="o">--&gt;</span>
  <span class="o">&lt;!--</span> <span class="nl">do_not_remove:</span> <span class="n">published</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">gradle</span><span class="o">-</span><span class="n">metadata</span> <span class="o">--&gt;</span>
  <span class="o">&lt;</span><span class="n">modelVersion</span><span class="o">&gt;</span><span class="mf">4.0</span><span class="o">.</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">modelVersion</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">validation</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="na">RELEASE</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">validation</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">description</span><span class="o">&gt;</span><span class="nc">Starter</span> <span class="k">for</span> <span class="n">using</span> <span class="nc">Java</span> <span class="nc">Bean</span> <span class="nc">Validation</span> <span class="n">with</span> <span class="nc">Hibernate</span> <span class="nc">Validator</span><span class="o">&lt;/</span><span class="n">description</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="nl">https:</span><span class="c1">//spring.io/projects/spring-boot&lt;/url&gt;</span>
  <span class="o">&lt;</span><span class="n">organization</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="nc">Pivotal</span> <span class="nc">Software</span><span class="o">,</span> <span class="nc">Inc</span><span class="o">.&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="nl">https:</span><span class="c1">//spring.io&lt;/url&gt;</span>
  <span class="o">&lt;/</span><span class="n">organization</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">licenses</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">license</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="nc">Apache</span> <span class="nc">License</span><span class="o">,</span> <span class="nc">Version</span> <span class="mf">2.0</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="nl">https:</span><span class="c1">//www.apache.org/licenses/LICENSE-2.0&lt;/url&gt;</span>
    <span class="o">&lt;/</span><span class="n">license</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">licenses</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">developers</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">developer</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="nc">Pivotal</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">email</span><span class="o">&gt;</span><span class="n">info</span><span class="nd">@pivotal</span><span class="o">.</span><span class="na">io</span><span class="o">&lt;/</span><span class="n">email</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">organization</span><span class="o">&gt;</span><span class="nc">Pivotal</span> <span class="nc">Software</span><span class="o">,</span> <span class="nc">Inc</span><span class="o">.&lt;/</span><span class="n">organization</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">organizationUrl</span><span class="o">&gt;</span><span class="nl">https:</span><span class="c1">//www.spring.io&lt;/organizationUrl&gt;</span>
    <span class="o">&lt;/</span><span class="n">developer</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">developers</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">scm</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">connection</span><span class="o">&gt;</span><span class="nl">scm:git:git:</span><span class="c1">//github.com/spring-projects/spring-boot.git&lt;/connection&gt;</span>
    <span class="o">&lt;</span><span class="n">developerConnection</span><span class="o">&gt;</span><span class="nl">scm:git:ssh:</span><span class="c1">//git@github.com/spring-projects/spring-boot.git&lt;/developerConnection&gt;</span>
    <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="nl">https:</span><span class="c1">//github.com/spring-projects/spring-boot&lt;/url&gt;</span>
  <span class="o">&lt;/</span><span class="n">scm</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">issueManagement</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">system</span><span class="o">&gt;</span><span class="nc">GitHub</span><span class="o">&lt;/</span><span class="n">system</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="nl">https:</span><span class="c1">//github.com/spring-projects/spring-boot/issues&lt;/url&gt;</span>
  <span class="o">&lt;/</span><span class="n">issueManagement</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">dependencies</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">2.3</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="na">RELEASE</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">compile</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">glassfish</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">jakarta</span><span class="o">.</span><span class="na">el</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">3.0</span><span class="o">.</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">compile</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
      <span class="o">&lt;!--</span> <span class="n">hibernate</span><span class="o">-</span><span class="n">validator实现</span><span class="o">--&gt;</span>
      <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">validator</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">hibernate</span><span class="o">-</span><span class="n">validator</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">6.1</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="na">Final</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">compile</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">dependencies</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">project</span><span class="o">&gt;</span>
</pre></table></code></div></div><h2 id="使用校验注解"><span class="mr-2">使用校验注解</span><a href="#使用校验注解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>JSR 380标准定义了许多注解，从字面上就可以推断出意思:</p><ul><li><strong>@NotNull</strong> 校验字段是否不为null<li><strong>@AssertTrue</strong> 校验字段值是否为true<li><strong>@Size</strong> 校验字段值是否在设置的min和max之间。可以作用于String，Collection，Map，array数组类型。<li><strong>@Min</strong> 校验字段值是否不小于设置的value<li><strong>@Max</strong> 校验字段值是否不大于设置的value<li><strong>@Email</strong> 校验字段值是否是有效邮箱地址<li><strong>@NotEmpty</strong> 校验字段值不是否不为null或空。可以作用于String，Collection，Map或Array类型。<li><strong>@NotBlank</strong> 只能作用于字符串类型，校验字段是否不为空串。和StringuUtils.isNotBlank类似。<li><strong>@Positive</strong> and <strong>@PositiveOrZero</strong> 作用于数字。校验字段值是否是整数或0。<li><strong>@Negative</strong> and <strong>@NegativeOrZero</strong> 作用于数字。校验字段值是否是负数或0。<li><strong>@Past</strong> and <strong>@PastOrPresent</strong> 校验日期是否已过或包括当前日期。<li><strong>@Future</strong> and <strong>@FutureOrPresent</strong> 校验日期是否没到或包括当前日期。</ul><p><strong>校验的注解可以作用于集合中的元素</strong>:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nd">@NotBlank</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">preferences</span><span class="o">;</span>
</pre></table></code></div></div><p>这种情况下所有被加进preferences的元素都会进行校验</p><p><strong>@Past和@Future 可以作用于Java8新增的LocalDate类型</strong></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="nc">LocalDate</span> <span class="n">dateOfBirth</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nd">@Past</span> <span class="nc">LocalDate</span><span class="o">&gt;</span> <span class="nf">getDateOfBirth</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">dateOfBirth</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>这里校验框架会自动拿出Optional里面的值进行校验。一般日常开发中以下两种使用方式会比较频繁</p><ul><li>在Controller参数上添加校验注解<li>在Controller参数的bean类上添加校验注解，比如VO，DTO类</ul><h2 id="编程式校验"><span class="mr-2">编程式校验</span><a href="#编程式校验" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Springboot环境下直接在方法的参数或bean的字段上添加对应的校验注解即可自动完成校验。下面来介绍一下如何手动进行校验。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">ValidatorFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="nc">Validation</span><span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">();</span>
<span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
</pre></table></code></div></div><p>使用ValidatorFactory工厂来生产一个Validator。</p><h3 id="定义bean"><span class="mr-2">定义bean</span><a href="#定义bean" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
 
    <span class="nd">@Positive</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"年龄不能小于{value}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

    <span class="nd">@NotBlank</span><span class="o">()</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Email</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"Email ${validatedValue} 不合法"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
 
    <span class="c1">// standard setters and getters </span>
<span class="o">}</span>
</pre></table></code></div></div><p>创建一个User</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">();</span>
<span class="n">user</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
<span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"demoemail.com"</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="message属性占位符"><span class="mr-2">message属性占位符</span><a href="#message属性占位符" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>在定义message错误消息时，可以使用<strong>{注解属性}</strong>来获得注解的属性值。通过<strong>${validatedValue}</strong>来获得被注解字段的值。</p><h3 id="校验bean"><span class="mr-2">校验bean</span><a href="#校验bean" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConstraintViolation</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;&gt;</span> <span class="n">validate</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
<span class="n">validate</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">userConstraintViolation</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userConstraintViolation</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
</pre></table></code></div></div><p>validate方法返回一个set，其中包含了所有的校验错误信息。遍历打印结果：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nc">Email</span> <span class="n">demoemail</span><span class="o">.</span><span class="na">com</span> <span class="n">不合法</span>
<span class="n">不能为空</span>
<span class="n">年龄不能小于1</span>
<span class="n">必须是正数</span>
</pre></table></code></div></div><h2 id="自定义校验注解"><span class="mr-2">自定义校验注解</span><a href="#自定义校验注解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>JSR380标准中的注解并不能完全满足自己的需求。可以根据需求写自己的校验注解，并需要实现一个校验器搭配食用。下面以校验<strong>ip地址</strong>为例介绍。</p><h3 id="注解"><span class="mr-2">注解</span><a href="#注解" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>定义一个名为IpAddress的注解，代码如下</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">PARAMETER</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="nc">IpAddressValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">IpAddress</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">message</span><span class="o">()</span> <span class="k">default</span> <span class="s">"ip地址无效"</span><span class="o">;</span>

    <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>

    <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
<span class="o">}</span>
</pre></table></code></div></div><p>@Constraint需要传入使用的校验器，下文会继续介绍。message()的default值有两种写法</p><ul><li>像上面那样写死，缺点是不支持国际化<li>定义一个key，这样会从properties文件中读取该key的value来替换。比较优雅，支持国际化。下文会详细介绍</ul><p>采用第二种比较优雅，扩展性强。默认的message，在使用该注解时也可以再传入mesage进行覆盖。</p><h3 id="校验器"><span class="mr-2">校验器</span><a href="#校验器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>自定义的校验器实现ConstraintValidator&lt;A extends Annotation, T&gt;接口即可。两个泛型A是自己写的注解名，T是该注解支持的校验字段类型。IpAddressValidator的代码如下：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">IpAddressValidator</span> <span class="kd">implements</span> <span class="nc">ConstraintValidator</span><span class="o">&lt;</span><span class="nc">IpAddress</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Pattern</span> <span class="no">PATTERN</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}$"</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">IpAddress</span> <span class="n">constraintAnnotation</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">String</span> <span class="n">ip</span><span class="o">,</span> <span class="nc">ConstraintValidatorContext</span> <span class="n">constraintValidatorContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="no">PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">ip</span><span class="o">).</span><span class="na">matches</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>isValid方法可以定义自己的校验逻辑。这里用正则表达式来校验ip地址的格式。</p><p>现在在user上添加ip属性，并添加上ipaddress注解</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="nd">@IpAddress</span><span class="o">()</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ip</span><span class="o">;</span>
</pre></table></code></div></div><p>程序运行结果</p><blockquote><p>ip地址无效 必须是正数 年龄不能小于1 不是一个合法的电子邮件地址 不能为空</p></blockquote><h3 id="message扩展与国际化"><span class="mr-2">message扩展与国际化</span><a href="#message扩展与国际化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><h4 id="文件位置"><span class="mr-2">文件位置</span><a href="#文件位置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>message中定义的key，都在ValidationMessages.properties文件中。使用hibernate validator的实现的话，文件位置为</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nl">D:</span><span class="err">\</span><span class="n">maven</span><span class="err">\</span><span class="n">repository</span><span class="err">\</span><span class="n">org</span><span class="err">\</span><span class="n">hibernate</span><span class="err">\</span><span class="n">validator</span><span class="err">\</span><span class="n">hibernate</span><span class="o">-</span><span class="n">validator</span><span class="err">\</span><span class="mf">6.1</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="na">Final</span><span class="err">\</span><span class="n">hibernate</span><span class="o">-</span><span class="n">validator</span><span class="o">-</span><span class="mf">6.1</span><span class="o">.</span><span class="mi">6</span><span class="o">.</span><span class="na">Final</span><span class="o">.</span><span class="na">jar</span><span class="o">!</span><span class="err">\</span><span class="n">org</span><span class="err">\</span><span class="n">hibernate</span><span class="err">\</span><span class="n">validator</span><span class="err">\</span><span class="nc">ValidationMessages</span><span class="o">.</span><span class="na">properties</span>
</pre></table></code></div></div><p>可以看到，不同语言的文件用下划线和国家isocode区分分别存储</p><p><img data-src="/assets/细说Java-Validation-Api.assets/image-20201111135907742.png" alt="" data-proofer-ignore></p><h4 id="扩展message-properties文件"><span class="mr-2">扩展message properties文件</span><a href="#扩展message-properties文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>可以自行编写messages.properties文件来扩展内置的消息。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">ipaddress</span><span class="o">.</span><span class="na">invalid</span><span class="o">=</span><span class="n">ip</span> <span class="n">address</span> <span class="n">invalid</span>
</pre></table></code></div></div><h4 id="国际化i18n"><span class="mr-2">国际化i18n</span><a href="#国际化i18n" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>不同语言的message文件用国家的isocode前面加上下划线来区分。例如messages_zh.properties的内容如下</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">ipaddress</span><span class="o">.</span><span class="na">invalid</span><span class="o">=</span><span class="n">ip地址无效</span>
</pre></table></code></div></div><p>文件结构如下</p><p><img data-src="/assets/细说Java-Validation-Api.assets/image-20201112100701925.png" alt="" data-proofer-ignore></p><h3 id="springboot环境集成"><span class="mr-2">SpringBoot环境集成</span><a href="#springboot环境集成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>properties文件写好了，Springboot环境下需要配置一下方可读取。</p><h4 id="bean配置"><span class="mr-2">bean配置</span><a href="#bean配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidationConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MessageSource</span> <span class="nf">messageSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ReloadableResourceBundleMessageSource</span> <span class="n">messageSource</span>
                <span class="o">=</span> <span class="k">new</span> <span class="nc">ReloadableResourceBundleMessageSource</span><span class="o">();</span>

        <span class="n">messageSource</span><span class="o">.</span><span class="na">setBasename</span><span class="o">(</span><span class="s">"classpath:messages"</span><span class="o">);</span>
        <span class="n">messageSource</span><span class="o">.</span><span class="na">setDefaultEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">messageSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">LocalValidatorFactoryBean</span> <span class="nf">getValidator</span><span class="o">(</span><span class="nc">MessageSource</span> <span class="n">messageSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">LocalValidatorFactoryBean</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LocalValidatorFactoryBean</span><span class="o">();</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setValidationMessageSource</span><span class="o">(</span><span class="n">messageSource</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>主要配置两个bean，配置mesageSource以可以读取咱们自己的messages.properties文件。配置LocalValidatorFactoryBean以使用咱们自己的messageSource</p><h4 id="创建容器并获取validator"><span class="mr-2">创建容器并获取validator</span><a href="#创建容器并获取validator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>这里为了方便，使用手动创建ApplicationContext的方式来创建Spring容器。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="nc">ValidationConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">LocalValidatorFactoryBean</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getAutowireCapableBeanFactory</span><span class="o">().</span><span class="na">getBean</span><span class="o">(</span><span class="nc">LocalValidatorFactoryBean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">bean</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
</pre></table></code></div></div><p>接着就可以和之前一样愉快得校验User对象了。</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConstraintViolation</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;&gt;</span> <span class="n">validate</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="n">validate</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">userConstraintViolation</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">userConstraintViolation</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()));</span>
</pre></table></code></div></div><p>运行代码，可以发现messages_zh.properties文件已被正常读取。</p><blockquote><p>不能为空 不是一个合法的电子邮件地址 必须是正数 年龄不能小于1 <strong>ip地址无效</strong></p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java-validation-api/" class="post-tag no-text-decoration" >Java-Validation-Api</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=细说Java Validation Api - Mike Liu&amp;url=https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=细说Java Validation Api - Mike Liu&amp;u=https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/&amp;text=细说Java Validation Api - Mike Liu" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-20-04-on-lenovo-t14s-amd-gen1/">Ubuntu 20.04 on Lenovo T14s AMD Gen1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java-validation-api/">Java-Validation-Api</a> <a class="post-tag" href="/tags/java8/">java8</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Java8-Stream-List%E8%BD%ACMap-Null%E5%80%BC%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"><div class="card-body"> <em class="timeago small" data-ts="1582207963" > 2020-02-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Java8 Stream List转Map Null值报错解决方法</h3><div class="text-muted small"><p> 问题场景 user LIst转成id-&amp;gt;email的map，若email存在Null的话，则会报NPE。user定义如下 @Setter @Getter @ToString class User { private Integer id; private String email; } 转换代码如下 Map&amp;lt;Integer, String&amp;gt;...</p></div></div></a></div><div class="card"> <a href="/posts/%E4%B8%BA%E4%BB%80%E4%B9%88Java%E5%9C%A8foreach%E9%87%8C%E9%9D%A2remove-add%E6%93%8D%E4%BD%9CList%E4%BC%9A%E6%8A%9B%E5%BC%82%E5%B8%B8/"><div class="card-body"> <em class="timeago small" data-ts="1590008812" > 2020-05-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>为什么Java在foreach里面remove/add操作List会抛异常</h3><div class="text-muted small"><p> 背景 平常工作大家都只是知道删除List的元素要用迭代器(iterator)，用foreach判断删除的话会抛异常。但是为什么会抛异常呢？ 来，先看看阿里巴巴Java开发手册中是如何写道的： 删除”1“不会抛异常，但是”2“却会。很神奇是不是？ Exception in thread &quot;main&quot; java.util.ConcurrentModificationException ...</p></div></div></a></div><div class="card"> <a href="/posts/ubuntu-20-04-on-lenovo-t14s-amd-gen1/"><div class="card-body"> <em class="timeago small" data-ts="1649589960" > 2022-04-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ubuntu 20.04 on Lenovo T14s AMD Gen1</h3><div class="text-muted small"><p> Basically, all machine functions working well, including: Intel AX200 wireless card HDMI output with audio DP output on USB-C port (one cable, including power supply, video and audio output...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E4%B8%BA%E4%BB%80%E4%B9%88Java%E5%9C%A8foreach%E9%87%8C%E9%9D%A2remove-add%E6%93%8D%E4%BD%9CList%E4%BC%9A%E6%8A%9B%E5%BC%82%E5%B8%B8/" class="btn btn-outline-primary" prompt="Older"><p>为什么Java在foreach里面remove/add操作List会抛异常</p></a> <a href="/posts/ubuntu-20-04-on-lenovo-t14s-amd-gen1/" class="btn btn-outline-primary" prompt="Newer"><p>Ubuntu 20.04 on Lenovo T14s AMD Gen1</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://xiaod-dev.github.io//posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/'; this.page.identifier = '/posts/%E7%BB%86%E8%AF%B4Java-Validation-Api/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://mikeliu.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/xiaod-dev">Mike Liu</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java-validation-api/">Java-Validation-Api</a> <a class="post-tag" href="/tags/java8/">java8</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-S0SXZ5LTXN"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-S0SXZ5LTXN'); }); </script>
